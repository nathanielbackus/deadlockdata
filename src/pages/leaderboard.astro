---
import BaseLayout from "../layouts/BaseLayout.astro";
import SortableTable from "../components/SortableTable.astro";

let leaderboardData = [];
let error = null;

const response = await fetch(
  "http://localhost:5333/fetchLeaderboard?start=1&limit=100"
);

const text = await response.text();

try {
  const result = JSON.parse(text);
  leaderboardData = result.results || result.data || [];
} catch (err) {
  error = "Invalid JSON received from API";
}

const pageTitle = "Top 100 Players";
---

<BaseLayout pageTitle={pageTitle}>
  {error ? (
    <p style="color: red;">Error: {error}</p>
  ) : (
    <SortableTable data={leaderboardData} />
  )}
</BaseLayout>
